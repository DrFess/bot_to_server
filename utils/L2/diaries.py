import time
from datetime import datetime
import random

import gspread
import holidays
import requests
from bs4 import BeautifulSoup

from settings import GOOGLE_TABLE_KEY, login_l2, password_l2


def get_patients_from_table(interval: str) -> list:
    """Получение списка номеров выписанных историй из сводной гугл-таблице"""
    gs = gspread.service_account(filename='utils/jsonS/access.json')
    sh = gs.open_by_key(GOOGLE_TABLE_KEY)

    worksheet = sh.get_worksheet_by_id(2071709469)

    result = []
    for item in worksheet.get(interval):
        if len(item) > 0:
            result.append(item[0])
    return result


def authorization_l2(connect, login, password):
    """Авторизация в L2"""
    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Connection': 'keep-alive',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Referer': 'http://192.168.10.161/ui/login',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36',
        'X-KL-kav-Ajax-Request': 'Ajax_Request',
    }

    json_data = {
        'username': f'{login}',
        'password': f'{password}',
        'totp': '',
    }

    response = connect.post('http://192.168.10.161/api/users/auth', headers=headers, json=json_data, verify=False)
    return response.status_code, response.json()


def add_diaries(connect, history_number: int, service_id: int):
    """Создаёт новый дневник"""

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }

    json_data = {
        'service': service_id,  # 2 - дневник, 5 - протокол операции, 20 - диагностический эпикриз, 479 - предоперационный эпикриз
        'main_direction': history_number,
    }

    response = connect.post(
        'http://192.168.10.161/api/stationar/make-service',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def get_pk(connect, diary_number):

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': diary_number,
        'force': True,
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/paraclinic_form',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def get_last_diaries(connect, pk):

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': pk,
        'isSameParent': True,
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/patient-history',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def data_by_fields(connect, pk):

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': pk,
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/data-by-fields',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def save_results(connect, pk, pk_2, local_status, history_number, what_inspection):

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }

    json_data = {
        'force': True,
        'data': {
            'pk': pk_2,  # pk созданного дневника
            'research': {
                'pk': 472,
                'title': 'Осмотр',
                'version': int(f'{pk_2}0000'),  # pk + ???
                'is_paraclinic': False,
                'is_doc_refferal': False,
                'is_gistology': False,
                'is_microbiology': False,
                'is_treatment': False,
                'is_stom': False,
                'isAux': False,
                'is_monitoring': False,
                'wide_headers': False,
                'comment': '',
                'groups': [
                    {
                        'pk': 2928,
                        'order': 1,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 16375,
                                'order': 1,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'лечащим врачом',
                                    'дежурным травматологом-ортопедом',
                                    'врачом-специалистом',
                                    'заведующим отделением',
                                    'лечащим врачом совместно с врачом-специалистом',
                                    'лечащим врачом совместно с заведующим отделением',
                                ],
                                'value': what_inspection,
                                'field_type': 12,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 511,
                        'order': 2,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 2283,
                                'order': 1,
                                'lines': 3,
                                'title': 'Дата осмотра',
                                'hide': False,
                                'values_to_input': [],
                                'value': datetime.now().strftime('%Y-%m-%d'),
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16607,
                                'order': 2,
                                'lines': 3,
                                'title': 'День недели',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': 'new Intl.DateTimeFormat("ru", {   weekday: "long" }).format(new Date("{2283}"))',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1879,
                                'order': 3,
                                'lines': 1,
                                'title': 'Время осмотра',
                                'hide': False,
                                'values_to_input': [],
                                'value': f'{random.randint(9, 12)}:{random.randint(10, 59)}',
                                'field_type': 20,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': True,
                    },
                    {
                        'pk': 3240,
                        'order': 3,
                        'title': 'Сведения о пациенте',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17786,
                                'order': 3,
                                'lines': 1,
                                'title': 'Дата поступления',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1818',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': True,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17795,
                                'order': 4,
                                'lines': 1,
                                'title': 'Время поступления',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1819',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': True,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17787,
                                'order': 5,
                                'lines': 3,
                                'title': 'День госпитализации',
                                'hide': False,
                                'values_to_input': [],
                                'value': 1,
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': 'Math.ceil(Math.abs(((new Date("{17786}".split(\'.\').reverse().join(\'-\'))).getTime() - (new Date("{2283}")).getTime()) / (1000 * 3600 * 24)) + 1)',
                                'visibility': '',
                                'required': False,
                                'helper': 'Math.ceil(Math.abs(((new Date("{17786}".split(\'.\').reverse().join(\'-\'))).getTime() - (new Date("{2283}")).getTime()) / (1000 * 3600 * 24)) + 1)',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': True,
                    },
                    {
                        'pk': 3242,
                        'order': 4,
                        'title': 'Диагноз',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17797,
                                'order': 1,
                                'lines': 2,
                                'title': 'Основное заболевание',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1878|1856',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17798,
                                'order': 2,
                                'lines': 1,
                                'title': 'Осложнение основного заболевания',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1930',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17799,
                                'order': 3,
                                'lines': 1,
                                'title': 'Сопутствующие заболевания',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1929',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17800,
                                'order': 4,
                                'lines': 3,
                                'title': 'Внешняя причина при травмах, отравлениях',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17801,
                                'order': 5,
                                'lines': 3,
                                'title': 'Дополнительные сведения о заболевании',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 513,
                        'order': 5,
                        'title': 'Жалобы при поступлении.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1889,
                                'order': 1,
                                'lines': 1,
                                'title': 'на боль в',
                                'hide': False,
                                'values_to_input': [
                                    'правом предплечье',
                                    'левом предплечье',
                                    'правом плече',
                                    'левом плече',
                                    'правой кисти',
                                    'левой кисти',
                                    'правом бедре',
                                    'левом бедре',
                                    'правой голени',
                                    'левой голени',
                                    'правой стопе',
                                    'левой стопе',
                                    'правом локтевом суставе',
                                    'левом локтевом суставе',
                                    'правом коленном суставе',
                                    'левом коленном суставе',
                                    'правом голеностопном суставе',
                                    'левом голеностопном суставе',
                                    'в области правой ключицы',
                                    'в области левой ключицы',
                                    'шее',
                                    'грудном отделе спины',
                                    'нижней части спины',
                                ],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1820',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1890,
                                'order': 2,
                                'lines': 1,
                                'title': 'на деформацию',
                                'hide': False,
                                'values_to_input': [
                                    'правого предплечья',
                                    'левого предплечья',
                                    'правого плеча',
                                    'левого плеча',
                                    'правой кисти',
                                    'левой кисти',
                                    'правого бедра',
                                    'левого бедра',
                                    'правой голени',
                                    'левой голени',
                                    'правой стопы',
                                    'левой стопы',
                                ],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1821',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1891,
                                'order': 3,
                                'lines': 1,
                                'title': 'на ограничение движений в',
                                'hide': False,
                                'values_to_input': [
                                    'правом локтевом суставе',
                                    'левом локтевом суставе',
                                    'правом плечевом суставе',
                                    'левом плечевом суставе',
                                    'правом тазобедренном суставе',
                                    'левом тазобедренном суставе',
                                    'правом коленном суставе',
                                    'левом коленном суставе',
                                    'правом голеностопном суставе',
                                    'левом голеностопном суставе',
                                    'шейном отделе позвоночника',
                                ],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1822',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1892,
                                'order': 4,
                                'lines': 1,
                                'title': 'на укорочение',
                                'hide': False,
                                'values_to_input': [
                                    'правой нижней конечности',
                                    'левой нижней конечности',
                                ],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1823',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1893,
                                'order': 5,
                                'lines': 1,
                                'title': 'на наличие раны',
                                'hide': False,
                                'values_to_input': [
                                    'правой кисти',
                                    'левой кисти',
                                    'правой голени',
                                    'левой голени',
                                    'правой стопы',
                                    'левой стопы',
                                ],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1824',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1894,
                                'order': 6,
                                'lines': 1,
                                'title': 'на наличие инородного тела',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1825',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1895,
                                'order': 7,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1826',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением" || {16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 1191,
                        'order': 6,
                        'title': 'Жалобы на момент осмотра.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 5140,
                                'order': 1,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'не предъявляет ',
                                    'прежние ',
                                    'отмечает уменьшение болевого синдрома',
                                ],
                                'value': 'Не предъявляет ',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 514,
                        'order': 7,
                        'title': 'Анамнез заболевания.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1896,
                                'order': 1,
                                'lines': 1,
                                'title': 'Дата начала заболевания, травмы',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1827',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1903,
                                'order': 8,
                                'lines': 3,
                                'title': 'Обстоятельства травмы, заболевания',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1831',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1943,
                                'order': 9,
                                'lines': 1,
                                'title': 'Проведенное лечение',
                                'hide': False,
                                'values_to_input': [
                                    'одномоментная закрытая ручная репозиция, фиксация гипсовыми шинами',
                                    'одномоментная закрытая ручная репозиция, фиксация на системе скелетного вытяжения',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением" || {16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 3260,
                        'order': 8,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17893,
                                'order': 1,
                                'lines': 2,
                                'title': 'Проведенное оперативное лечение',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%proto_operation',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} !== "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 515,
                        'order': 9,
                        'title': 'Данные объективного обследования.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1904,
                                'order': 1,
                                'lines': 1,
                                'title': 'Общее состояние',
                                'hide': False,
                                'values_to_input': [
                                    'удовлетворительное',
                                    'ближе к удовлетворительному',
                                    'средней тяжести',
                                    'тяжёлое',
                                ],
                                'value': 'средней тяжести',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'средней тяжести',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17796,
                                'order': 2,
                                'lines': 1,
                                'title': 'Уровень сознания по шкале Глазго',
                                'hide': False,
                                'values_to_input': [
                                    'Сознание ясное (15 баллов)',
                                    'Умеренное оглушение (13-14 баллов)',
                                    'Глубокое оглушение (10-12 баллов)',
                                    'Сопор (8-9 баллов)',
                                ],
                                'value': 'Сознание ясное (15 баллов)',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'Сознание ясное (15 баллов)',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1906,
                                'order': 4,
                                'lines': 1,
                                'title': 'Температура тела (градусы Цельсия)',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '36,5',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1907,
                                'order': 5,
                                'lines': 1,
                                'title': 'Положение',
                                'hide': False,
                                'values_to_input': [
                                    'активное',
                                    'пассивное',
                                    'вынужденное',
                                ],
                                'value': '',
                                'field_type': 12,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1908,
                                'order': 6,
                                'lines': 2,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': 'Самочувствие не страдает. Кожный покров обычной окраски, чистые. Pulm – дыхание проводится во все отделы, хрипов нет. Cor – тоны ясные ритмичные, шумов нет. Живот мягкий, безболезненный. Стул, мочеиспускание не нарушено. ',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'Самочувствие не страдает. Кожный покров обычной окраски, чистые. Pulm – дыхание проводится во все отделы, хрипов нет. Cor – тоны ясные ритмичные, шумов нет. Живот мягкий, безболезненный. Стул, мочеиспускание не нарушено. ',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1917,
                                'order': 16,
                                'lines': 1,
                                'title': 'ЧСС в минуту',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': '[_age_] <= 2 ? Math.floor(Math.random() * (130 - 120 + 1)) + 120 : [_age_] <= 4 ? Math.floor(Math.random() * (105 - 100 + 1)) + 100 : [_age_] <= 5 ? Math.round(Math.random() * (100 - 95 + 1)) + 95 : [_age_] <= 6 ? Math.floor(Math.random() * (95 - 90 + 1)) + 90 : [_age_] <= 8 ? Math.floor(Math.random() * (85 - 80 + 1)) + 80 :  Math.floor(Math.random() * (80 - 70 + 1)) + 70',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1919,
                                'order': 17,
                                'lines': 1,
                                'title': 'ЧДД в минуту',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': '[_age_] <= 2 ? Math.floor(Math.random() * (30 - 26 + 1)) + 26 : [_age_] <= 4 ? Math.floor(Math.random() * (26 - 23 + 1)) + 23 : [_age_] <= 10 ? Math.round(Math.random() * (23 - 20 + 1)) + 20 : [_age_] <= 12 ? Math.round(Math.random() * (20 - 18 + 1)) + 18 :  Math.floor(Math.random() * (18 - 16 + 1)) + 16',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 516,
                        'order': 10,
                        'title': 'Локальный статус.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1922,
                                'order': 1,
                                'lines': 3,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': local_status,
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 517,
                        'order': 11,
                        'title': 'Проведенное обследование.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1924,
                                'order': 2,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 17,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением" || {16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1926,
                                'order': 4,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 16,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением" || {16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 2515,
                                'order': 5,
                                'lines': 2,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 518,
                        'order': 12,
                        'title': 'На основании клинико-анамнестических данных и дополнительных методов обследования установлен:',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17891,
                                'order': 2,
                                'lines': 3,
                                'title': 'Диагноз клинический',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%root_hosp#1874#',
                                'visibility': '{17893} != ""',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1928,
                                'order': 3,
                                'lines': 3,
                                'title': 'Диагноз клинический',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1878|1856',
                                'visibility': '{17893} === ""',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1930,
                                'order': 5,
                                'lines': 1,
                                'title': 'осложнения',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1929,
                                'order': 6,
                                'lines': 1,
                                'title': 'сопутствующий',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} != "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 519,
                        'order': 13,
                        'title': 'Коррекция плана обследования.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 16376,
                                'order': 4,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} != "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 520,
                        'order': 14,
                        'title': 'Коррекция плана лечения.',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1935,
                                'order': 1,
                                'lines': 1,
                                'title': 'Режим',
                                'hide': False,
                                'values_to_input': [
                                    'общий',
                                    'палатный',
                                    'постельный',
                                    'строгий постельный',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1936,
                                'order': 2,
                                'lines': 1,
                                'title': 'Стол',
                                'hide': False,
                                'values_to_input': [
                                    'общий',
                                    '16',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                                'required': False,
                                'helper': '16 стол для детей до 3х лет',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1938,
                                'order': 3,
                                'lines': 1,
                                'title': 'Физиотерапия',
                                'hide': False,
                                'values_to_input': [
                                    'Переменное магнитное поле на  № ',
                                    'Амплипульс (расслабляющий) на  № ',
                                    'Амплипульс (тонизирующий) на  № ',
                                    'Элетрофорез с раствором Новокаина 2% на  № ',
                                    'Элетрофорез с раствором Эуфиллина 2.4% на  № ',
                                    'Парафиновая терапия на  № ',
                                    'УВЧ на  № ',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1939,
                                'order': 4,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'лечебная физкультура №',
                                    'массаж  № ',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1940,
                                'order': 5,
                                'lines': 1,
                                'title': 'Манипуляции',
                                'hide': False,
                                'values_to_input': [
                                    'Пункция  коленного сустава ',
                                    'Гипсование по Лоренц',
                                    'Ежедневные перевязки',
                                    'Закрытая ручная репозиция, гипсовая иммобилизация',
                                    'Закрытая ручная репозиция. Фиксация на системе скелетного вытяжения',
                                    'Клеевое вытяжение ',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1941,
                                'order': 6,
                                'lines': 1,
                                'title': 'Оперативное вмешательство',
                                'hide': False,
                                'values_to_input': [
                                    'Закрытая репозиция, МОС',
                                    'Удаление металлоконструкций',
                                    'Открытая репозиция, МОС',
                                    'Лечебно-диагностическая артроскопия  коленного сустава',
                                    'Ахиллотомия по Байеру ',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 5139,
                                'order': 7,
                                'lines': 3,
                                'title': 'Дата оперативного лечения, манипуляции',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{1940} != '' || {1941} != ''",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 2516,
                                'order': 8,
                                'lines': 1,
                                'title': 'Планируется',
                                'hide': False,
                                'values_to_input': [
                                    'продолжить лечение и наблюдение в условиях отделения до купирования отека мягких тканей.',
                                    'продолжить лечение на системе скелетного вытяжения до купирования отека мягких тканей и появления признаков консолидации.',
                                    'продолжить лечение и наблюдение в условиях отделения до купирования болевого синдрома, достаточной натренированности мышц спины.',
                                    'выходные дни. Наблюдение дежурными врачами при ухудшении состояния',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 1937,
                                'order': 9,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'выходные дни. Наблюдение дежурными врачами при ухудшении состояния',
                                'visibility': '{16607} == "пятница" || {16607} == "суббота"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16377,
                                'order': 10,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'Выписывается на амбулаторный этап лечения.',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'Выписывается на амбулаторный этап лечения.',
                                'visibility': '{1904} == "удовлетворительное"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16378,
                                'order': 11,
                                'lines': 1,
                                'title': 'Исход заболевания',
                                'hide': False,
                                'values_to_input': [
                                    'выписан с улучшением',
                                    'выписан с выздоровлением',
                                    'выписан без перемен',
                                    'выписан с ухудшением',
                                    'переведен в другое учреждение ',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '{1904} == "удовлетворительное"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} != "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 3243,
                        'order': 15,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17802,
                                'order': 1,
                                'lines': 2,
                                'title': 'Обоснование необходимости проведения оперативного вмешательства (операции), медицинские показания',
                                'hide': False,
                                'values_to_input': [
                                    'смещение и нестабильность костных отломков',
                                    'стойкая контрактура',
                                    'деформация конечности',
                                    'наличие открытой раной',
                                    'наличие инородного тела',
                                    'стойкий болевой синдром при неэффективности консервативного лечения',
                                    'врожденный порок развития',
                                    'вертели мы ваши приказы на болту',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 17803,
                                'order': 2,
                                'lines': 1,
                                'title': 'планируемое оперативное вмешательство (операция)',
                                'hide': False,
                                'values_to_input': [
                                    'закрытая репозиция, МОС',
                                    'удаление металлоконструкции',
                                    'открытая репозиция, МОС',
                                    'лечебно-диагностическая артроскопия   сустава',
                                    'ахиллотомия по Байеру',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 3241,
                        'order': 16,
                        'title': 'Этапный эпикриз',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 17788,
                                'order': 1,
                                'lines': 3,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'с положительной динамикой',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': True,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '({17787} % 10 == 0 && {16607} != "суббота" && {16607} != "воскресенье") && {16375} != "оперирующим врачом (Предоперационный эпикриз)" || ({17787} % 9 == 0 && {16607} == "пятница") && {16375} != "оперирующим врачом (Предоперационный эпикриз)" || ({17787} % 8 == 0 && {16607} == "пятница") && {16375} != "оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 522,
                        'order': 17,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1944,
                                'order': 1,
                                'lines': 2,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 521,
                        'order': 18,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1942,
                                'order': 1,
                                'lines': 1,
                                'title': 'Согласие на медицинское вмешательство',
                                'hide': False,
                                'values_to_input': [
                                    'проведен консилиум в составе: ',
                                ],
                                'value': 'получено от законного представителя.',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': 'получено от законного представителя.',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16151,
                                'order': 2,
                                'lines': 1,
                                'title': 'Ребёнок госпитализирован',
                                'hide': False,
                                'values_to_input': [],
                                'value': 'один',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1886',
                                'visibility': '{16375} != "оперирующим врачом (Предоперационный эпикриз)"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16152,
                                'order': 3,
                                'lines': 1,
                                'title': 'Сопровождающий в листе нетрудоспособности',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '2517',
                                'visibility': '{16151} != "один" && {16151} != ""',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 523,
                        'order': 19,
                        'title': 'Обоснование временной нетрудоспособности (В соответствии с приказом МЗ РФ от 23.11.2021г. №1089, раздел V. Формирование ЛН по уходу за больным членом семьи)',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 1945,
                                'order': 1,
                                'lines': 1,
                                'title': 'кому',
                                'hide': False,
                                'values_to_input': [
                                    'матери',
                                    'отцу',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16136,
                                'order': 2,
                                'lines': 1,
                                'title': 'Фамилия',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%mother_family',
                                'visibility': "{1945} == 'матери'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16137,
                                'order': 3,
                                'lines': 1,
                                'title': 'Имя',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%mother_name',
                                'visibility': "{1945} == 'матери'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16138,
                                'order': 4,
                                'lines': 1,
                                'title': 'Отчество',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%mother_patronymic',
                                'visibility': "{1945} == 'матери'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16139,
                                'order': 5,
                                'lines': 1,
                                'title': 'Дата рождения',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%mother_born',
                                'visibility': "{1945} == 'матери'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16140,
                                'order': 6,
                                'lines': 1,
                                'title': 'ЭЛН по уходу за',
                                'hide': False,
                                'values_to_input': [
                                    'сыном',
                                    'дочерью',
                                    'внуком',
                                    'внучкой',
                                    'племянником',
                                    'племянницей',
                                    'опекаемым',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16141,
                                'order': 7,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '%patient_fio',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16142,
                                'order': 8,
                                'lines': 3,
                                'title': 'С',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16143,
                                'order': 9,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'на весь период госпитализации',
                                    'на оставшийся период',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16144,
                                'order': 10,
                                'lines': 1,
                                'title': 'Первичный ЭЛН по уходу (номер)',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16145,
                                'order': 11,
                                'lines': 1,
                                'title': 'Выдан (медицинское учреждение)',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16146,
                                'order': 12,
                                'lines': 1,
                                'title': 'С',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16147,
                                'order': 13,
                                'lines': 3,
                                'title': 'По',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16148,
                                'order': 14,
                                'lines': 3,
                                'title': 'Календарных дней',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': 'Math.ceil(Math.abs(((new Date("{16146}".split(\'.\').reverse().join(\'-\'))).getTime() - (new Date("{16147}")).getTime()) / (1000 * 3600 * 24)) + 1)',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16149,
                                'order': 15,
                                'lines': 3,
                                'title': 'Явка на врачебную комиссию',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16150,
                                'order': 16,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': "{16143} == 'На оставшийся период'",
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16152} === "нуждается"&&{16375} !="дежурным травматологом-ортопедом"&&{16378} ==""',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 2929,
                        'order': 20,
                        'title': '',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 16379,
                                'order': 1,
                                'lines': 1,
                                'title': 'Лист нетрудоспособности №',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16381,
                                'order': 2,
                                'lines': 1,
                                'title': 'Выдан кому',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '1945&&16136&&16137&&16138&&16139',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16382,
                                'order': 3,
                                'lines': 1,
                                'title': 'по уходу за',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '16140&16141',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16383,
                                'order': 4,
                                'lines': 1,
                                'title': 'выдан с',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 14,
                                'can_edit': False,
                                'default_value': '16142',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 18036,
                                'order': 5,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16384,
                                'order': 6,
                                'lines': 1,
                                'title': 'по',
                                'hide': False,
                                'values_to_input': [],
                                'value': '2024-02-18',
                                'field_type': 1,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16385,
                                'order': 7,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'ЭЛН закрыт',
                                    'ребёнок продолжает болеть и нуждается в индивидуальном уходе',
                                ],
                                'value': '',
                                'field_type': 0,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16386,
                                'order': 8,
                                'lines': 3,
                                'title': 'К труду',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': 'new Intl.DateTimeFormat("ru", {   year: \'numeric\',   month: \'long\',   day: \'numeric\', }).format(new Date(+new Date("{16384}") + 86400000))',
                                'visibility': '{16385} == "ЭЛН закрыт"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16387,
                                'order': 9,
                                'lines': 1,
                                'title': '',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': '\'явка в поликлинику по месту жительства: \'+new Intl.DateTimeFormat("ru", {   year: \'numeric\',   month: \'long\',   day: \'numeric\', }).format(new Date("{16384}"))',
                                'visibility': '{16385} == "Ребёнок продолжает болеть и нуждается в индивидуальном уходе"',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                            {
                                'pk': 16388,
                                'order': 10,
                                'lines': 3,
                                'title': 'Количество календарных дней',
                                'hide': False,
                                'values_to_input': [],
                                'value': '',
                                'field_type': 3,
                                'can_edit': False,
                                'default_value': 'Math.ceil(Math.abs(((new Date("{16383}".split(\'.\').reverse().join(\'-\'))).getTime() - (new Date("{16384}")).getTime()) / (1000 * 3600 * 24)) + 1)',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16378} != ""&&{16375} !="дежурным травматологом-ортопедом"&&{16152} === "нуждается"&&{16375} !="оперирующим врачом (Предоперационный эпикриз)"',
                        'fieldsInline': False,
                    },
                    {
                        'pk': 646,
                        'order': 21,
                        'title': 'Заведующий отделением',
                        'show_title': True,
                        'hide': False,
                        'display_hidden': False,
                        'fields': [
                            {
                                'pk': 2285,
                                'order': 1,
                                'lines': 3,
                                'title': '',
                                'hide': False,
                                'values_to_input': [
                                    'Яковлев А.Б.',
                                    'Большаков Г.А.',
                                    'Дегтярев А.А.',
                                ],
                                'value': '',
                                'field_type': 12,
                                'can_edit': False,
                                'default_value': '',
                                'visibility': '',
                                'required': False,
                                'helper': '',
                                'controlParam': '',
                                'not_edit': False,
                                'operator_enter_param': False,
                                'deniedGroup': '',
                            },
                        ],
                        'visibility': '{16375} == "лечащим врачом совместно с заведующим отделением"',
                        'fieldsInline': False,
                    },
                ],
                'can_transfer': False,
                'is_extract': False,
                'transfer_direction': None,
                'transfer_direction_iss': [],
                'r_type': 'diaries',
                'show_more_services': True,
                'enabled_add_files': False,
            },
            'pacs': None,
            'examination_date': '2024-02-18',
            'templates': [
                {
                    'pk': 907,
                    'title': 'AVN справа',
                },
                {
                    'pk': 732,
                    'title': 'вывих бедра с 2х (Лор1)',
                },
                {
                    'pk': 731,
                    'title': 'вывих бедра слева (Лор1)',
                },
                {
                    'pk': 730,
                    'title': 'вывих бедра справа (Лор1)',
                },
                {
                    'pk': 868,
                    'title': 'вывих костей левого предплечья (до вправления)',
                },
                {
                    'pk': 486,
                    'title': 'вывих костей левого предплечья до репозиции',
                },
                {
                    'pk': 870,
                    'title': 'вывих костей левого предплечья (после вправления)',
                },
                {
                    'pk': 491,
                    'title': 'Вывих костей левого предплечья после репозиции',
                },
                {
                    'pk': 249,
                    'title': 'вывих костей правого предплечья (до вправления)',
                },
                {
                    'pk': 478,
                    'title': 'вывих костей правого предплечья до репозиции',
                },
                {
                    'pk': 869,
                    'title': 'вывих костей правого предплечья (после вправления)',
                },
                {
                    'pk': 488,
                    'title': 'Вывих костей правого предплечья после репозиции',
                },
                {
                    'pk': 271,
                    'title': 'вывих плеча слева(до вправления)',
                },
                {
                    'pk': 275,
                    'title': 'вывих плеча слева(после вправления)',
                },
                {
                    'pk': 268,
                    'title': 'вывих плеча справа(до вправления) ',
                },
                {
                    'pk': 272,
                    'title': 'вывих плеча справа(после вправления)',
                },
                {
                    'pk': 736,
                    'title': 'киста бедра слева',
                },
                {
                    'pk': 735,
                    'title': 'киста бедра справа',
                },
                {
                    'pk': 633,
                    'title': 'Киста Бейкера слева.',
                },
                {
                    'pk': 634,
                    'title': 'Киста Бейкера справа.',
                },
                {
                    'pk': 738,
                    'title': 'киста большеберцовой слева',
                },
                {
                    'pk': 737,
                    'title': 'киста большеберцовой справа',
                },
                {
                    'pk': 734,
                    'title': 'киста плеча слева',
                },
                {
                    'pk': 733,
                    'title': 'киста плеча справа',
                },
                {
                    'pk': 740,
                    'title': 'киста пятки слева',
                },
                {
                    'pk': 739,
                    'title': 'киста пятки справа',
                },
                {
                    'pk': 906,
                    'title': 'колено слева артроскопия',
                },
                {
                    'pk': 248,
                    'title': 'компрессионный перелом ГОП',
                },
                {
                    'pk': 724,
                    'title': 'миграция бедро слева',
                },
                {
                    'pk': 723,
                    'title': 'миграция бедро справа',
                },
                {
                    'pk': 726,
                    'title': 'миграция большеберцовая слева',
                },
                {
                    'pk': 725,
                    'title': 'миграция большеберцовая справа',
                },
                {
                    'pk': 677,
                    'title': 'миграция луч слева',
                },
                {
                    'pk': 676,
                    'title': 'миграция луч справа',
                },
                {
                    'pk': 681,
                    'title': 'миграция плечо слева',
                },
                {
                    'pk': 680,
                    'title': 'миграция плечо справа',
                },
                {
                    'pk': 679,
                    'title': 'миграция пред слева',
                },
                {
                    'pk': 678,
                    'title': 'миграция пред справа',
                },
                {
                    'pk': 729,
                    'title': 'нотта с 2х',
                },
                {
                    'pk': 728,
                    'title': 'нотта слева',
                },
                {
                    'pk': 727,
                    'title': 'нотта справа',
                },
                {
                    'pk': 693,
                    'title': 'Осгуд слева (перфорации)',
                },
                {
                    'pk': 691,
                    'title': 'Осгуд слева (фрагмент)',
                },
                {
                    'pk': 692,
                    'title': 'Осгуд справа (перфорации)',
                },
                {
                    'pk': 690,
                    'title': 'Осгуд справа (фрагмент)',
                },
                {
                    'pk': 261,
                    'title': 'перелом 1й пястной кости левой кисти',
                },
                {
                    'pk': 259,
                    'title': 'перелом 1й пястной кости правой кисти',
                },
                {
                    'pk': 264,
                    'title': 'перелом акромиального конца слева(до операции)',
                },
                {
                    'pk': 269,
                    'title': 'перелом акромиального конца слева(после операции)',
                },
                {
                    'pk': 263,
                    'title': 'перелом акромиального конца справа(до операции)',
                },
                {
                    'pk': 266,
                    'title': 'перелом акромиального конца справа(после оперции)',
                },
                {
                    'pk': 360,
                    'title': 'перелом бедра в\\3 слева (до вытяжения)',
                },
                {
                    'pk': 367,
                    'title': 'перелом бедра в\\3 слева (после вытяжения)',
                },
                {
                    'pk': 358,
                    'title': 'перелом бедра в\\3 справа (до вытяжения)',
                },
                {
                    'pk': 323,
                    'title': 'перелом бедра в\\3 справа(после вытяжения)',
                },
                {
                    'pk': 310,
                    'title': 'перелом бедра с\\3 слева (до вытяжения)',
                },
                {
                    'pk': 324,
                    'title': 'перелом бедра с\\3 слева(после вытяжения)',
                },
                {
                    'pk': 309,
                    'title': 'перелом бедра с\\3 справа (до вытяжения)',
                },
                {
                    'pk': 369,
                    'title': 'перелом внутренней части мыщелка левой плечевой кости (до операции)',
                },
                {
                    'pk': 371,
                    'title': 'перелом внутренней части мыщелка правой плечевой кости (до операции)',
                },
                {
                    'pk': 630,
                    'title': 'перелом голени большеберцовая  с\\3 слева (после вытяжения)',
                },
                {
                    'pk': 631,
                    'title': 'перелом голени обе с\\3  справа (после вытяжения)',
                },
                {
                    'pk': 632,
                    'title': 'перелом голени с\\3 обе слева (до вытяжения)',
                },
                {
                    'pk': 368,
                    'title': 'перелом голени с\\3 обе справа (до вытяжения)',
                },
                {
                    'pk': 370,
                    'title': 'перелом голени с\\3 слева большеберцовая (до вытяжения)',
                },
                {
                    'pk': 258,
                    'title': 'перелом ключицы с/3 слева(до операции)',
                },
                {
                    'pk': 262,
                    'title': 'перелом ключицы с/3 слева(после операции)',
                },
                {
                    'pk': 257,
                    'title': 'перелом ключицы с/3 справа (до операции)',
                },
                {
                    'pk': 260,
                    'title': 'перелом ключицы с/3 справа(после операции)',
                },
                {
                    'pk': 250,
                    'title': 'перелом левой лучевой кости в н\\3 (до репозиции) ',
                },
                {
                    'pk': 252,
                    'title': 'перелом левой лучевой кости в н\\3 (после репозиции)',
                },
                {
                    'pk': 298,
                    'title': 'перелом левой лучевой кости в с\\3 (до репозиции) ',
                },
                {
                    'pk': 301,
                    'title': 'перелом левой лучевой кости в с\\3 (после репозиции)',
                },
                {
                    'pk': 277,
                    'title': 'перелом н\\ф пальца левой кисти с повреждением сухожилия разгибателя',
                },
                {
                    'pk': 278,
                    'title': 'перелом н\\ф пальца правой кисти с повреждением сухожилия разгибателя',
                },
                {
                    'pk': 254,
                    'title': 'перелом обеих костей левого предплечья в н\\3 (до репозции)',
                },
                {
                    'pk': 256,
                    'title': 'перелом обеих костей левого предплечья в н\\3 (после репозиции)',
                },
                {
                    'pk': 293,
                    'title': 'перелом обеих костей левого предплечья в с\\3 (до операции)',
                },
                {
                    'pk': 292,
                    'title': 'перелом обеих костей левого предплечья в с\\3 (до репозциии',
                },
                {
                    'pk': 296,
                    'title': 'перелом обеих костей левого предплечья в с\\3 (после операции)',
                },
                {
                    'pk': 295,
                    'title': 'перелом обеих костей левого предплечья в с\\3 (после репозиции)',
                },
                {
                    'pk': 253,
                    'title': 'перелом обеих костей правого предплечья в н\\3 (до репозции)',
                },
                {
                    'pk': 255,
                    'title': 'перелом обеих костей правого предплечья в н\\3 (после репозиции) ',
                },
                {
                    'pk': 285,
                    'title': 'перелом обеих костей правого предплечья в с\\3 (до операции)',
                },
                {
                    'pk': 284,
                    'title': 'перелом обеих костей правого предплечья в с\\3 (до репозциии)',
                },
                {
                    'pk': 290,
                    'title': 'перелом обеих костей правого предплечья в с\\3 (после операции)',
                },
                {
                    'pk': 289,
                    'title': 'перелом обеих костей правого предплечья в с\\3 (после репозиции)',
                },
                {
                    'pk': 280,
                    'title': 'перелом плеча в/3 слева(до вытяжения)',
                },
                {
                    'pk': 282,
                    'title': 'перелом плеча в/3 слева(после вытяжения)',
                },
                {
                    'pk': 279,
                    'title': 'перелом плеча в/3 справа (до вытяжения)',
                },
                {
                    'pk': 281,
                    'title': 'перелом плеча в/3 справа(после вытяжения)',
                },
                {
                    'pk': 286,
                    'title': 'перелом плеча с/3 слева(до вытяжения)',
                },
                {
                    'pk': 294,
                    'title': 'перелом плеча с/3 слева(до операции)',
                },
                {
                    'pk': 288,
                    'title': 'перелом плеча с/3 слева(после вытяжения)',
                },
                {
                    'pk': 302,
                    'title': 'перелом плеча с/3 слева(после операции)',
                },
                {
                    'pk': 283,
                    'title': 'перелом плеча с/3 справа(до вытяжения)',
                },
                {
                    'pk': 291,
                    'title': 'перелом плеча с/3 справа(до операции)',
                },
                {
                    'pk': 287,
                    'title': 'перелом плеча с/3 справа(после вытяжения)',
                },
                {
                    'pk': 300,
                    'title': 'перелом плеча с/3 справа(после операции)',
                },
                {
                    'pk': 251,
                    'title': 'перелом правой лучевой кости в н\\3  (после репозиции)',
                },
                {
                    'pk': 297,
                    'title': 'перелом правой лучевой кости в с\\3 (до репозиции)',
                },
                {
                    'pk': 299,
                    'title': 'перелом правой лучевой кости в с\\3  (после репозиции)',
                },
                {
                    'pk': 267,
                    'title': 'перелом пястной кости левой кисти',
                },
                {
                    'pk': 265,
                    'title': 'перелом пястной кости правой кисти ',
                },
                {
                    'pk': 273,
                    'title': 'перелом фаланги пальца левой кисти (до операции)',
                },
                {
                    'pk': 270,
                    'title': 'перелом фаланги пальца левой кисти (после операции)',
                },
                {
                    'pk': 274,
                    'title': 'перелом фаланги пальца правой кисти (до операции)',
                },
                {
                    'pk': 276,
                    'title': 'перелом фаланги пальца правой кисти (после операции)',
                },
                {
                    'pk': 304,
                    'title': 'перелом шейки левой лучевой кости (до операции) ',
                },
                {
                    'pk': 306,
                    'title': 'перелом шейки левой лучевой кости (после операции) ',
                },
                {
                    'pk': 303,
                    'title': 'перелом шейки правой лучевой кости (до операции) ',
                },
                {
                    'pk': 305,
                    'title': 'перелом шейки правой лучевой кости (после операции) ',
                },
                {
                    'pk': 683,
                    'title': 'полидактилия 1 п кисти слева',
                },
                {
                    'pk': 682,
                    'title': 'полидактилия 1 п кисти справа',
                },
                {
                    'pk': 685,
                    'title': 'полидактилия кисти слева',
                },
                {
                    'pk': 684,
                    'title': 'полидактилия кисти справа',
                },
                {
                    'pk': 247,
                    'title': 'По умолчанию',
                },
                {
                    'pk': 920,
                    'title': 'Синдактилия 3-4 кисти слева',
                },
                {
                    'pk': 904,
                    'title': 'транзиторный синовит тбс слева',
                },
                {
                    'pk': 903,
                    'title': 'транзиторный синовит тбс справа',
                },
                {
                    'pk': 669,
                    'title': 'удаление бедро слева',
                },
                {
                    'pk': 668,
                    'title': 'удаление бедро справа',
                },
                {
                    'pk': 675,
                    'title': 'удаление большеберцовая слева',
                },
                {
                    'pk': 674,
                    'title': 'удаление большеберцовая справа',
                },
                {
                    'pk': 665,
                    'title': 'удаление ключица слева',
                },
                {
                    'pk': 664,
                    'title': 'удаление ключица справа',
                },
                {
                    'pk': 657,
                    'title': 'удаление луч слева',
                },
                {
                    'pk': 656,
                    'title': 'удаление луч справа',
                },
                {
                    'pk': 663,
                    'title': 'удаление плечо слева',
                },
                {
                    'pk': 662,
                    'title': 'удаление плечо справа',
                },
                {
                    'pk': 660,
                    'title': 'удаление пред слева',
                },
                {
                    'pk': 659,
                    'title': 'удаление пред справа',
                },
                {
                    'pk': 361,
                    'title': 'чрезмыщелковый перелом  левого плеча (до репозиции)',
                },
                {
                    'pk': 362,
                    'title': 'чрезмыщелковый перелом левого плеча (после репозиции)',
                },
                {
                    'pk': 363,
                    'title': 'чрезмыщелковый перелом правого плеча (до репозиции)',
                },
                {
                    'pk': 364,
                    'title': 'чрезмыщелковый перелом правого плеча (после репозиции)',
                },
            ],
            'saved': True,
            'confirmed': False,
            'confirmed_at': None,
            'allow_reset_confirm': False,
            'more': [],
            'sub_directions': [],
            'recipe': [],
            'lab_comment': '',
            'forbidden_edit': False,
            'maybe_onco': False,
            'work_by': None,
            'tube': None,
            'procedure_list': [],
            'is_form': False,
            'children_directions': [],
            'parentDirection': {
                'pk': history_number,
                'service': 'Травматология',
                'is_hospital': True,
            },
            'whoSaved': None,
            'whoConfirmed': None,
            'whoExecuted': None,
            'countFiles': 0,
            'direction': {
                'pk': pk,
            },
            'stationar_research': -1,
        },
        'with_confirm': False,
        'visibility_state': {
            'groups': {
                '511': True,
                '513': False,
                '514': False,
                '515': True,
                '516': True,
                '517': True,
                '518': True,
                '519': True,
                '520': True,
                '521': True,
                '522': False,
                '523': False,
                '646': False,
                '1191': True,
                '2928': True,
                '2929': False,
                '3240': True,
                '3241': False,
                '3242': False,
                '3243': False,
                '3260': True,
            },
            'fields': {
                '1879': True,
                '1904': True,
                '1906': False,
                '1907': False,
                '1908': True,
                '1917': True,
                '1919': True,
                '1922': True,
                '1924': False,
                '1926': False,
                '1928': True,
                '1929': True,
                '1930': True,
                '1935': False,
                '1936': False,
                '1937': False,
                '1938': True,
                '1939': True,
                '1940': True,
                '1941': True,
                '1942': True,
                '2283': True,
                '2515': True,
                '2516': True,
                '5139': False,
                '5140': True,
                '16151': True,
                '16152': False,
                '16375': True,
                '16376': True,
                '16377': False,
                '16378': False,
                '16607': True,
                '17786': True,
                '17787': True,
                '17793': False,
                '17794': False,
                '17795': False,
                '17796': True,
                '17891': False,
                '17893': True,
            },
        },
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/paraclinic_result',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.status_code, response.json()


def get_list_pk(connect, history_number):
    """Возвращает словарь с рк всех дневников истории"""
    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
        'X-CSRFToken': 'SxDRTVyx15Vy03wCdXebph11vhsIhi61',
    }

    json_data = {
        'direction': history_number,
        'r_type': 'all',
        'every': False,
    }

    response = connect.post(
        'http://192.168.10.161/api/stationar/directions-by-key',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def get_weekend_and_holidays(year) -> dict:

    data = requests.get(f'https://www.consultant.ru/law/ref/calendar/proizvodstvennye/{year}/').text

    soup = BeautifulSoup(data, 'html.parser')

    days = soup.findAll('table', class_='cal')
    month = 0
    weekends_and_holidays = {}
    for day in days:
        month += 1
        item = day.find_all('td', class_='weekend')
        list_days = []
        for i in item:
            list_days.append(i.text)
        weekends_and_holidays[month] = list_days

    return weekends_and_holidays


def get_first_research(connect, pk: int):
    """Получить данные из первичного осмотра"""
    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': pk,
        'force': True,
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/paraclinic_form',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json().get('researches')[0].get('research').get('groups')


def get_patient_pk(connect, history_number: str):
    """Возвращает pk пациента"""
    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': history_number,
        'every': False,
    }

    response = connect.post('http://192.168.10.161/api/stationar/load', headers=headers, json=json_data, verify=False)
    return response.json().get('data').get('patient').get('card_pk')


def is_surgery_planned(connect, patient_number: int):
    """Проверяет, есть ли запланированная операция"""

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',
    }

    json_data = {
        'card_pk': patient_number,  # pk карточки пациента, не номер истории или номер протокола истории
    }

    response = connect.post(
        'http://192.168.10.161/api/plans/get-plan-operations-by-patient',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()  # возвращает словарь с ключом data, если нет операции - {'data': []}, иначе .get('data')[0]


def get_all_records(connect, history_number: int):
    """Получает все записи по номеру истории"""
    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',
    }

    json_data = {
        'direction': history_number,
        'r_type': 'all',
        'every': False,
    }

    response = connect.post(
        'http://192.168.10.161/api/stationar/directions-by-key',
        headers=headers,
        json=json_data,
        verify=False,
    )
    return response.json()


def get_record_details(connect, record_number: int):

    headers = {
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
        'Content-Type': 'application/json',
        'DNT': '1',
        'Origin': 'http://192.168.10.161',
        'Proxy-Connection': 'keep-alive',
        'Referer': 'http://192.168.10.161/ui/stationar',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',
    }

    json_data = {
        'pk': record_number,
        'force': True,
    }

    response = connect.post(
        'http://192.168.10.161/api/directions/paraclinic_form',
        headers=headers,
        json=json_data,
        verify=False,
    ).json()
    return response.get('researches')[0].get('research').get('groups')[0].get('fields')[0].get('value')


def create_diaries_function():
    current_year = datetime.now().year
    holidays.country_holidays('RU', years=current_year)
    holidays_and_weekend = get_weekend_and_holidays(current_year)

    session = requests.Session()

    authorization_l2(session, login=login_l2, password=password_l2)

    patients = get_patients_from_table('C3:C42')
    patients_out_of_stock = get_patients_from_table('K3:K42')
    patients.extend(patients_out_of_stock)

    for history_number in patients:
        try:
            data = add_diaries(session, int(history_number), service_id=2)
            pk = data.get('pk')
            data_1 = get_pk(session, pk)
            date_str = data_1.get('direction').get('date')
            date_list = date_str.split('.')
            holidays_and_weekend_in_month = holidays_and_weekend.get(int(date_list[1]))

            weekday = datetime.strptime(date_str, '%d.%m.%Y')
            weekday_number = weekday.isoweekday()
            pk_1 = data_1.get('researches')[0].get('pk')
            data_2 = get_last_diaries(session, pk_1)
            pk_2 = data_2.get('data')[0].get('pk')
            local_status = data_by_fields(session, pk_2).get('data').get('1922')
            if date_list[0] in holidays_and_weekend_in_month:
                save_results(
                    connect=session,
                    pk=pk,
                    pk_2=pk_1,
                    local_status=local_status,
                    history_number=history_number,
                    what_inspection='дежурным травматологом-ортопедом'
                )
            elif weekday_number in (1, 5) and date_list[0] not in holidays_and_weekend_in_month:
                save_results(
                    connect=session,
                    pk=pk,
                    pk_2=pk_1,
                    local_status=local_status,
                    history_number=history_number,
                    what_inspection='лечащим врачом совместно с заведующим отделением'
                )
            else:
                save_results(
                    connect=session,
                    pk=pk,
                    pk_2=pk_1,
                    local_status=local_status,
                    history_number=history_number,
                    what_inspection='лечащим врачом'
                )
            time.sleep(2)

        except IndexError:
            pass
        except Exception as e:
            print(f'Error: {e}')
    session.close()
    return 'Дневники созданы'
